<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h2>Chào mừng bạn đến với hệ thống bãi đỗ xe thông minh</h2>
    <p>ID RFID của bạn: <span id="rfid_id">Đang tải...</span></p>
    <p>Biển số xe: <span id="plate">Đang tải...</span></p>
    <p>Thời hạn thẻ: <span id="expiration">Đang tải...</span></p>
    <button id="renew">Gia hạn thẻ</button>
    <button id="logout">Đăng xuất</button>

    <script type="module">
      import { auth, database } from "./firebase-config.js";
      import {
        ref,
        get,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
      import { signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

      auth.onAuthStateChanged(async (user) => {
        if (user) {
          const userRef = ref(database, "users/" + user.uid);
          const snapshot = await get(userRef);

          if (snapshot.exists()) {
            const userData = snapshot.val();
            document.getElementById("rfid_id").textContent = userData.rfid_id;
            document.getElementById("plate").textContent =
              userData.plate || "Chưa cập nhật";
            document.getElementById("expiration").textContent =
              userData.expiration || "Chưa gia hạn";
          }
        } else {
          window.location.href = "login.html";
        }
      });

      document.getElementById("renew").addEventListener("click", () => {
        window.location.href = "renew.html";
      });

      document.getElementById("logout").addEventListener("click", async () => {
        await signOut(auth);
        window.location.href = "../index.html";
      });
    </script>
  </body>
</html>
